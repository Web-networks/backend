# Backend-part of application 

## Содержание
1. [Настройка окружения и установка необходмых пакетов для разработки (Linux, MacOS)](#settings-env)
2. [Разработка](#dev-rules)
3. [Контейнеризация](#docker) 
4. [Проверки pre-commit](#commit-checks)
5. [CI](#CI)

<a name="settings-env"></a>

### Настройка окружения и установка необходмых пакетов для разработки (Linux, MacOS)
Серверная часть будет писаться на TS. Чтобы вести разработку необходимо уставноить `nvm` и `node`.
```
wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash
nvm install 10
nvm alias default 10
```
Также нужно установить утилиту `yarn`: https://yarnpkg.com/

После этого можно устанвливать пакеты зависимотей для данного проекта, выполнив команду:
```
yarn
```

<a name="dev-rules"></a>

## Разработка
Если на предыдущих шагах все прошло успешно, можно начинать разработку. Для этого нужно запустить следующую команду:
```
yarn start-dev
```
Она запустит сервер в режими _development_ и любые изменения в коде сервера автоматически будут приводить к его перезапуску. В консоле появится информация о хосте, на котором запущен сервер. С другими командами можно ознакомиться в `package.json`.

<a name="docker"></a>

## Контейнеризация 
Чтобы запустить приложение в _docker контейнере_ нужно сделать следующие:
```
docker build . -t <name of image>
docker run -p 5050:5050 <name of image>
```
Можно запустить так же образ который находится в удаленном репозитории (см ниже). Пример запуска последней стабильной версии:
```
docker run -p 8000:5050 networksidea/backend:latest
```
**Важно указать правильную проброску портов!**: `-p <port on your host>:5050`, важно что в контейнере сервер слушает порт `5050`!
Контейнер запускает сервер в режиме _production_.

Также к git-репозиторию привязан docker hub oraganisation: https://hub.docker.com/orgs/networksidea.
Нужно подать заявку для членства в организации, чтобы иметь доступ к `push` своих свобственных кастомных образов.
Сейчас образы собираются по следующим правилам автоматически (реагируют на гитовые web хуки):
1. На каждое обновление `master`, при этом образ собирается из последнего коммита и доступен под тегом `latest`:
```
docker pull networksidea/backend:latest
``` 
2. На каждый релизный тэг в мастер: `tag=0.10.1` => образ можно получить под тегом: `release-0.10.1`:
```
docker pull networksidea/backend:release-0.10.1
```
3. На каждый _push_ в произвольную ветку => соответсвующий тэг будет иметь имя ветки
```
docker pull networksidea/backend:<branch-name> 
```

Если хочется запушить свой собственный _docker_ образ (например он нужен другим разработчикам для интеграции), то
запушить свой образ можно так:
```
docker push networksidea/backend:<tagname>
```
_tagname_ **не должен быть**: `latest`, `<branch-name>`, `release-<...>` в силу правил описанных выше.
Соответственно другому разработчику можно получить образ выполнив команду:
```
docker pull networksidea/backend:<tagname>
```

<a name="commit-checks"></a>

## Проверки pre-commit
Перед тем как сделать коммит прогонится линтер: `yarn lint`. В случае нарушения Code Style или соверешния ошибок, видимых при статической обработке кода, коммит не удасться сделать. В этом случае необходимо поправить код в тех местах, где ошибки и повторить попытку коммита.

<a name="CI"></a>

## CI
На каждый push в репозиторий запускаются некоторые тесты
1. Eslint проверки